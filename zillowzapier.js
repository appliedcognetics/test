const fetch = require ('node-fetch');

var inputData ={
raw:`96     New message about 515 W 122 #66, Manhattan, NY, 10027
Ines found your listing on:
Ines Corot asked:
"I am interested in this rental and would like to schedule a viewing. Please let me know when this would be possible."
Reply directly to this email or
SMS text   Call   About Ines Corot
Move in
a month
Credit score
720 to 850
Income
$150000
Pets
-
Smoker
false
Manage your listing
$1,995/mo
Studio bd | 1 ba | -- sqft
515 W 122 #66 Manhattan, NY 10027
FOR RENT
Other helpful links
Found a tenant and no longer wish to get inquiries for this property? Deactivate this listing
Is this inquiry spam? Report spam
Know your fair housing obligations under Zillow's Respectful Renting Pledge
Have questions or need help? Find answers on our FAQ page , or contact us .
Zillow, Inc.
1301 Second Avenue, Floor 31
Seattle, WA 98101
© 2006-2019
Privacy policy
   <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width" /><!--[if gte mso 9]> <xml> <o:OfficeDocumentSettings> <o:AllowPNG/> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml> <![endif]--> <style>a {text-decoration: none}</style></head><body bgcolor="#FFFFFF" width="100%" style="-webkit-font-smoothing: antialiased; background:#FFFFFF;-webkit-text-size-adjust:none; margin:0; padding:0;"><img src="https://hotpads.com/t/089ab8f2-7641-11e9-bfeb-0ebe306259a4" height="0" width="0" style="display:none;width:0;height:0;" /><table cellpadding="0" cellspacing="0" border="0" style="padding:0px;margin:0px;width:100%;"><tr><td colspan="3" style="padding:0px;margin:0px;font-size:20px;height:20px;" height="20">&nbsp;</td></tr><tr><td style="padding:0px;margin:0px;">&nbsp;</td><td style="padding:0px;margin:0px;" width="600"> <table border="0" cellPadding="0" cellSpacing="0" style="width:100%"><tbody><tr><td style="color:#2A2A33;font-size:16px;font-family:Arial;line-height:22px;padding:0"><div><table border="0" cellPadding="0" cellSpacing="0" style="width:100%;margin:auto"><tbody><tr><td style="text-align:center;padding:25px 10px"><a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://www.zillow.com?ref=undefined&amp;uvl=undefined&amp;utm_source=inquiry&amp;utm_medium=email&amp;utm_campaign=unified_email-renderer&amp;nid=089ab8f2-7641-11e9-bfeb-0ebe306259a4"><img style="height:30px;width:140px" src="https://nodes3cdn.hotpads.com/email-renderer/dist/zillow-logo-3nwCMb4.png" width="140"/></a></td></tr><tr><td><hr noshade="true" style="width:150px;margin:auto;color:#FFD237;padding:0;border:none;height:3px;background-color:#FFD237"/></td></tr><tr><td style="padding:30px"><div style="font-size:25px;line-height:34px;font-weight:bold;text-align:center;color:#001751">New message about <a style="text-decoration:none;cursor:pointer;color:#006AFF" href="https://zillow.com/rental-manager/properties/2719891_StreetEasy/listing?utm_term=managePropertyLink&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry">515 W 122 #66, Manhattan, NY, 10027</a></div></td></tr></tbody></table><table align="center" border="0" cellPadding="0" cellSpacing="0" style="margin:auto;max-width:504px;color:#444"><tbody><tr><td><table align="center" border="0" cellPadding="0" cellSpacing="0" style="text-align:center;margin:auto;margin-top:-22px"><tbody><tr><td style="text-align:left;white-space:nowrap"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#666">Ines found your listing on:</div></td><td style="text-align:left"><a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://www.trulia.com/rental/4016931435?utm_term=pledgeLink&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry&amp;nid=089ab8f2-7641-11e9-bfeb-0ebe306259a4"><img style="padding-left:8px;width:50%;text-align:left" src="https://nodes3cdn.hotpads.com/email-renderer/dist/lead-attribution-trulia-3M3SUhS.png"/></a></td></tr></tbody></table></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="margin:24px 0px;padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-top:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:8px 24px"><div style="font-size:16px;line-height:22px;font-weight:normal"><span style="font-weight:bold">Ines Corot</span> asked:</div></td></tr><tr><td style="padding:8px 24px 16px 24px"><div style="font-size:20px;line-height:30px;font-weight:normal;color:#444">&quot;I am interested in this rental and would like to schedule a viewing. Please let me know when this would be possible.&quot;</div></td></tr><tr><td><table align="center" border="0" cellPadding="0" cellSpacing="0" width="90%"><tbody><tr><tr><td style="padding:8px 0;text-align:center;margin:auto"><div style="font-size:16px;line-height:22px;font-weight:normal;color:#444"><b>Reply directly to this email </b>or</div></td></tr><tr><td style="padding:8px 0;text-align:center;margin:auto"><a style="width:100%;min-width:68px;margin:0px;cursor:pointer;text-align:center;text-decoration:none;white-space:normal;border-radius:4px;outline:none;font-size:16px;display:inline-block;box-sizing:border-box;border-width:11px 24px;border-style:solid;color:#FFF;background-color:#006AFF;border-color:#006AFF;font-weight:600;max-width:288px" rel="noopener noreferrer" target="_blank" href="https://www.zillow.com/rental-manager/inquiry-contact?controlHash=b976bf56a191b6daa666027d8d670afe&amp;inquiryId=1542898568607239636&amp;landlordBrand=zillow&amp;renterBrand=trulia&amp;name=Ines%20Corot&amp;phone=(078)%20257-7188&amp;date=05/14/19&amp;intentionType=sms&amp;utm_term=sms&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry"><img style="width:16px;vertical-align:middle" src="https://nodes3cdn.hotpads.com/email-renderer/dist/text-zillow-1cRwhCI.png"/>  SMS text</a></td></tr><tr><td style="padding:8px 0;text-align:center;margin:auto"><a style="width:100%;min-width:68px;margin:0px;cursor:pointer;text-align:center;text-decoration:none;white-space:normal;border-radius:4px;outline:none;font-size:16px;display:inline-block;box-sizing:border-box;border-width:11px 24px;border-style:solid;color:#FFF;background-color:#006AFF;border-color:#006AFF;font-weight:600;max-width:288px" rel="noopener noreferrer" target="_blank" href="https://www.zillow.com/rental-manager/inquiry-contact?controlHash=b976bf56a191b6daa666027d8d670afe&amp;inquiryId=1542898568607239636&amp;landlordBrand=zillow&amp;renterBrand=trulia&amp;name=Ines%20Corot&amp;phone=(078)%20257-7188&amp;date=05/14/19&amp;intentionType=call&amp;utm_term=call&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry"><img style="width:16px;vertical-align:middle" src="https://nodes3cdn.hotpads.com/email-renderer/dist/call-zillow-1I2sfh8.png"/>  Call</a></td></tr></tr></tbody></table></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="margin:24px 0px;padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-top:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><tr><td style="padding-left:24px;padding-right:24px"><div style="font-size:16px;line-height:22px;font-weight:bold">About Ines Corot</div></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" width="100%"><tbody><tr><td style="padding:16px 24px 16px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Move in</div><div style="font-size:16px;line-height:22px;font-weight:bold">a month</div></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-bottom:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:16px 24px 16px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Credit score</div><div style="font-size:16px;line-height:22px;font-weight:bold">720 to 850</div></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-bottom:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:16px 24px 16px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Income</div><div style="font-size:16px;line-height:22px;font-weight:bold">$150000</div></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-bottom:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:16px 24px 16px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Pets</div><div style="font-size:16px;line-height:22px;font-weight:bold">-</div></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-bottom:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:16px 24px 16px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Smoker</div><div style="font-size:16px;line-height:22px;font-weight:bold">false</div></td></tr></tbody></table></td></tr></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="margin:24px 0px;padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-top:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:0px 24px 16px 24px"><div style="font-size:16px;line-height:22px;font-weight:bold;color:#444">Manage your listing</div></td></tr><tr><td><table align="center" border="0" cellPadding="0" cellSpacing="0" style="width:470px;height:185px;border:1px solid #d9d9d9;border-radius:3px" width="470"><tbody><tr><td style="width:190px;height:185px;display:inline-block" valign="top" width="190"><a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://zillow.com/rental-manager/properties/2719891_StreetEasy/listing?utm_term=managePropertyLink&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry?ref=undefined&amp;uvl=undefined&amp;utm_source=inquiry&amp;utm_medium=email&amp;utm_campaign=unified_email-renderer&amp;nid=089ab8f2-7641-11e9-bfeb-0ebe306259a4"><table border="0" cellPadding="0" cellSpacing="0"><tbody><tr><td height="185" valign="middle" width="190"><img src="https://photonet.hotpads.com/search/listingPhoto/StreetEasy/2719891/0000_964464302_large.jpg" style="width:100%;display:block" width="190"/></td></tr></tbody></table></a></td><td width="16"> </td><td height="153" style="vertical-align:top;display:inline-block;width:241px;height:153px" valign="top" width="241"><div style="margin-top:16px;margin-bottom:4px"><span style="color:#333333;font-weight:normal;font-size:26px;font-family:Open Sans, Open-Sans, Arial">$1,995/mo</span></div><div style="line-height:18px;margin-bottom:4px"><span style="font-weight:600;font-family:Open Sans, Open-Sans, Arial;font-size:14px">Studio </span><span style="font-weight:normal;font-family:Open Sans, Open-Sans, Arial;font-size:14px">bd</span><span style="color:#ccc"> | </span><span style="font-weight:600;font-family:Open Sans, Open-Sans, Arial;font-size:14px">1 </span><span style="font-weight:normal;font-family:Open Sans, Open-Sans, Arial;font-size:14px">ba</span><span style="color:#ccc"> | </span><span style="font-weight:600;font-family:Open Sans, Open-Sans, Arial;font-size:14px">-- </span><span style="font-weight:normal;font-family:Open Sans, Open-Sans, Arial;font-size:14px">sqft</span></div><div style="margin-bottom:4px"><a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://zillow.com/rental-manager/properties/2719891_StreetEasy/listing?utm_term=managePropertyLink&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry?ref=undefined&amp;uvl=undefined&amp;utm_source=inquiry&amp;utm_medium=email&amp;utm_campaign=unified_email-renderer&amp;nid=089ab8f2-7641-11e9-bfeb-0ebe306259a4"><span style="color:#333333;line-height:18px;font-weight:normal;text-decoration:none;font-size:14px;font-family:Open Sans, Open-Sans, Arial;display:inline-block;overflow:hidden">515 W 122 #66 Manhattan, NY 10027</span></a></div><div style="margin-bottom:4px"><img style="vertical-align:baseline" src="https://nodes3cdn.hotpads.com/email-renderer/dist/status-purple-24c31-O.png" width="10" height="10"/><span style="font-size:13px;font-weight:bold"> FOR RENT</span></div></td><td width="16"> </td></tr></tbody></table></td></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="margin:24px 0px;padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-top:1px solid #f2f2f2;line-height:0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:0px 24px 16px 24px"><div style="font-size:16px;line-height:22px;font-weight:bold;color:#444">Other helpful links</div></td></tr><tr><td style="padding:8px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Found a tenant and no longer wish to get inquiries for this property? <a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://www.zillow.com/rental-manager/deactivate?encodedAlias=zt09n3yqjf1c&amp;utm_source=LeadInquiry&amp;utm_medium=email&amp;utm_campaign=LeadInquiry&amp;utm_content=ExpireItNow?controlHash=b976bf56a191b6daa666027d8d670afe&amp;inquiryId=1542898568607239636&amp;landlordBrand=zillow&amp;renterBrand=trulia&amp;utm_term=deactivation&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry">Deactivate this listing</a></div></td></tr><tr><td style="padding:8px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Is this inquiry spam? <a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://www.zillow.com/rental-manager/inquiry-contact?controlHash=b976bf56a191b6daa666027d8d670afe&amp;inquiryId=1542898568607239636&amp;landlordBrand=zillow&amp;renterBrand=trulia&amp;name=Ines%20Corot&amp;phone=(078)%20257-7188&amp;date=05/14/19&amp;intentionType=reportInquiryAsSpam&amp;utm_term=reportInquiryAsSpam&amp;utm_source=UnifiedInquiry&amp;utm_medium=email&amp;utm_campaign=UnifiedInquiry">Report spam</a></div></td></tr><tr><td style="padding:8px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Know your fair housing obligations under Zillow&#x27;s <a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://www.zillow.com/corp/respectful-renting-pledge/">Respectful Renting Pledge</a></div></td></tr><tr><td style="padding:8px 24px"><div style="font-size:13px;line-height:20px;font-weight:normal;color:#444">Have questions or need help? Find answers on our <a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://help.zillowrentalmanager.com/hc/en-us">FAQ page</a>, or <a style="text-decoration:none;cursor:pointer;color:#006AFF;font-weight:bold" href="https://help.zillowrentalmanager.com/hc/en-us/requests/new?ticket_form_id=190098">contact us</a>.</div></td><tr><td style="padding:8px 24px;line-height:0"><span> </span></td></tr></tr><tr><td><table border="0" cellPadding="0" cellSpacing="0" style="margin:24px 0px;padding:0 24px" width="100%"><tbody><tr><td style="width:100%;border-top:1px solid #f2f2f2;line-height:0;padding:4px 0"><span> </span></td></tr></tbody></table></td></tr><tr><td style="padding:24px 0;text-align:center"><img width="50%" src="https://nodes3cdn.hotpads.com/email-renderer/dist/logos-ZG-3brands-1DsWYL2.png"/></td></tr></tbody></table><table border="0" cellPadding="0" cellSpacing="0" style="font-size:14px;width:100%;color:#75757A;padding-top:10px;padding-bottom:12px;border-top:1px solid #F9F9FB" width="100%"><tbody><tr><td align="center"><div style="text-align:center;margin:auto"><div style="clear:both;padding:8px 0px"><div>Zillow, Inc.</div><div>1301 Second Avenue, Floor 31</div><div>Seattle, WA 98101</div><div>© 2006-2019</div></div><div style="clear:both;padding:8px 0px"><a style="text-decoration:none;cursor:pointer;color:#75757A;font-weight:bold" href="https://www.zillow.com/corp/Privacy.htm?utm_source=email&amp;utm_medium=email&amp;utm_campaign=emm-footerprivacy-HomeReport">Privacy policy</a></div></div></td></tr></tbody></table></div></td></tr></tbody></table></td><td style="padding:0px;margin:0px;">&nbsp;</td></tr><tr><td colspan="3" style="padding:0px;margin:0px;font-size:20px;height:20px;" height="20">&nbsp;</td></tr></table></body></html>
`

,replyto: "testme@gmail.com",
fromname :"firstName LastName",
date: "1/1/1970",
subject :"Stephanie is requesting information about 628 W 138 #3R, Manhattan, NY, 10031"

}

async function zap (inputData) {
const pluscodekey ="AIzaSyBqeAMkHMiXKA-3QiBKqjryi3X9cof2FZM";
const emailregex = /([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/i;
const phoneregex =/(\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4})/i;
// Get the plus code
function getpluscode (listing) {
// returns the promise of getting the vid for the given email, returns the word default if there is no value returned
//console.log ("url"+(`https://plus.codes/api/?address=${encodeURIComponent(listing)}&key=${pluscodekey}`));
return fetch (`https://plus.codes/api/?address=${encodeURIComponent(listing)}&key=${pluscodekey}`).then(response => response.json())
.then(data => (typeof data.plus_code === "undefined") ? "default" : data.plus_code.global_code )
.catch(error => {console.error(error)})
}

function replacer (match,capture,offset,wholestring)
{return String.fromCharCode(parseInt(capture,16)) };
function rp2 (match,capture,offset,wholestring)
{ // Do different operations for different tags
// this is for an alt tage in an image
// if (capture.replace(/^img[^>]+alt=3D\W([\w]+)\W>/g,'[$1]')) {return "["+capture+"]"}
if (capture.match (/alt=3D|alt=\W([\w]+)\W/)) { return "["+capture.match (/alt=3D|alt=\W([\w]+)\W/)[1]+"]";} ///^img[^>]+alt=3D\W([\w]+)\W/
// preserve any anchor tags
if (capture.match (/^a[^>]+(https?:[^"]+)\W/)) { return "["+capture.match (/^a[^>]+(https?:[^"]+)\W/)[1]+"]";}
if (capture.match (/^a[^>]+(mailto?:[^"]+)\W/)) { return "["+capture.match (/^a[^>]+(mailto?:[^"]+)\W/)[1]+"]";}
// preserve any emails embedded in <>
if (capture.match (/^([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/)) { return "["+capture+"]" }
// return a lf for a td for zillow might process differently for other providers
if (capture.match (/^tr/)) { return "\n" }
//End Blocks with a delimiter "###"
if (capture.match (/^table/)) { return "###" }
//if (capture.match (/^br/)) { return "###" }
// otherwise return ""
return "";
};
var f ={};
f.body=inputData.raw.replace(/=\s\n/g,"").replace(/\<([^>]+)>/g,rp2).replace(/\n?=C2=A0\n?/g," ").replace(/=([A-F0-9]{2})/g,replacer);
//console.log (`${f.body} \n\n`);
const d = f.body.match (/date:\s+([,+\([A-Za-z\s[0-9:]*\))/i) || [] ;
// Match Reply-To Email address
// NO CC Match CC this will be the agent that was assigned the lead
// const cc = f.body.match (/^cc:\s+([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/im);
// Match the from
// const from = f.body.match (/from:\s*\"([\s\w]+)\"\s?\[?([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)\]/i)|| [] ;
// Logger.log ("from:"+ from);
const p =f.body.match(/phone\=([^\&]+)/i) || [] ;
// const note = f.body.match(/is\savailable\:([\w\W]+)(?:reply)/i) || [];
const note = ((f.body.split(/reply\sdirectly/i) || [])[0])||"-" ; //split on reply
// console.log("\n\n******note:"+note+"\n\n");
/*note.forEach(element => {console.log("**************************\n\n\n\:"+element)
});
*/
// const fromline = f.body.match(/from:\s?\"?([\s\w]+)\"?\s*\[?([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)\]/i) || [];
// Logger.log ("ANL: "+fromline);

const listing = ((inputData.subject.match (/(?:information\sabout|application\sfor|to\stour)(.*)/i) || [])[1]||"-").trim();
const listingurl=((f.body.match(/found\syour\slisting\son\:\[(.+)\]/i) || [])[1]||"-").trim();
f.listingurl= listingurl;
f.listing =listing;
f.pluscode = await getpluscode(f.listing);
f.name = inputData.fromname || "-";
f.phone = decodeURIComponent(p.pop()) ||"-";
f.email = inputData.replyto;
//f.from = from.pop() || "";
// f.cc = (cc && !(typeof cc[1] ==="undefined")) ? cc[1]:" ";
f.date = inputData.date;
f.note = note.replace(/\W|\s{/ig," ").trim();
//look for an name in the subject line
f.phone = (!f.phone && phoneregex.test(f.note)) ? f.note.match(phoneregex)[1] :f.phone;
// *********** Turn this into a function
// find and name and split it into 1st and last name
if (f.name && !emailregex.test(f.name)) {
//if the f.name is not an email
// try to split the fname on spaces
const namesplit = f.name.trim().split(/\s+/);
if (namesplit.length > 1 ) { f.firstname = namesplit[0];
f.lastname =namesplit.pop();}
else { f.firstname =f.name , f.lastname = "";}
}
// try to find the name in the email address
// *********** Turn this into a function
if (f.name && emailregex.test (f.name)){
// maybe there is a name in the Email Address
const esplit = (f.name.split (/@/)[0].split('.'));
if (esplit.length > 0) {f.name = esplit.join(" ");
f.firstname = esplit[0];
f.lastname =esplit.pop();
};
};
const aboutme = ((f.body.match(/about\sme([^\#]{3,})/i) || [])[1])|| "-";
f.movein =(aboutme.match(/move\W?-in\s*(.*)/i) || [])[1]||"-";
// Logger.log ("mmmm:"+movein);
// Logger.log ("MOVEIN:"+aboutme[1].match(/move\W?-in\s*(.*)/i) );
f.creditscore =(aboutme.match(/credit\s?score\s*(.*)/i) || [])[1]||"-";
f.income =(aboutme.match(/income\s*(.*)/i) || [])[1]||"-";
f.jobtitle =(aboutme.match(/job\s?title\s*(.*)/i) || [])[1]||"-";
f.employer =(aboutme.match(/employer\s*(.*)/i) || [])[1]||"-";
f.employedsince =(aboutme.match(/employed\s?since\s*(.*)/i) || [])[1]||"-";
f.pastjobs =(aboutme.match(/past\s?jobs\s*(.*)/i) || [])[1]||"-";
f.reasonformoving =(aboutme.match(/reason\s?for\s?moving\s*(.*)/i) || [])[1]||"-";
f.employer =(aboutme.match(/employer\s*(.*)/i) || [])[1]||"-";
f.pets =(aboutme.match(/pets\s*(.*)/i) || [])[1]||"-";
f.leaselength =(aboutme.match(/lease\s*length\s*(.*)/i) || [])[1]||"-";
f.parking =(aboutme.match(/parking\s*(.*)/i) || [])[1]||"-";
f.employer =(aboutme.match(/employer\s*(.*)/i) || [])[1]||"-";
f.smoker =(aboutme.match(/smoker\s*(.*)/i) || [])[1]||"-";
f.desiredneighborhood =(aboutme.match(/desired\s?neighborhoods\s*(.*)/i) || [])[1]||"-";
// Look at the intent of the message to figure out how to respond
//const agent ={sms:'+13473709408',hubspotid:'35013679'};
const agent = (function (cc) {
switch (cc){
case 'chris@coulthrust.com' : return {sms :'+13473709408',hubspotid :'35013679'}
case 'david@stonecrestrealty.com' : return {sms :'+16173080839',hubspotid:'35029194'}
case 'caroline@stonecrestrealty.com':return{sms:'+13473709408',hubspotid:'35029193'}
case 'tzur@stonecrestrealty.com' : return {sms:'+13476851115',hubspotid:'35032776'}
case 'f.z@stonecrestrealty.com' : return {sms:'+13473709408',hubspotid:'35028612'}
default : return {sms:'+13473709408',hubspotid:''};
}})(inputData.cc);
output = {phone : f.phone,
name : f.name,
email :f.email,
note:f.note,
listing:f.listing,
listingurl: f.listingurl,
date: f.date,
firstname :f.firstname,
lastname : f.lastname ,
creditscore :f.creditscore ,
income : f.income ,
jobtitle :f.jobtitle,
employer : f.employer,
employedsince :f.employedsince,
pastjobs : f.pastjobs,
reasonformoving :f.reasonformoving,
employer : f.employer,
pets : f.pets ,
leaselength : f.leaselength ,
parking : f.parking,
employer : f.employer ,
desiredneighborhood : f.desiredneighborhood,
smoker : f.smoker,
sms :agent.sms ,
hubspotid:agent.hubspotid,
pluscode : f.pluscode}
//console.log (f.body);

console.log (output);

}

var a  = zap (inputData);
